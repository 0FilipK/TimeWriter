!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t){e.exports=require("express")},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,(n=[{key:"countLines",value:function(e){for(var t=1,n=0;n<e.length;n++)"\n"===e[n]&&t++;return t}},{key:"getColumn",value:function(e,t){for(var n=0,r=t;r>0&&"\n"!=e[r-1];r--)n++;return n}},{key:"getCaretCoordinates",value:function(e,t){t=this._clipPosition(t,e);for(var n={line:0,column:0},r=0;r<t;r++)n=this._reduceCoordinates(n,e[r]);return n}},{key:"getCaretPosition",value:function(e,t){for(var n=0,r={line:0,column:0},o=this._clipCoordinates(t,e);r.line<o.line&&n<e.length;)r=this._reduceCoordinates(r,e[n++]);for(;r.column<o.column&&n<e.length&&"\n"!==e[n];)r=this._reduceCoordinates(r,e[n++]);return n}},{key:"getEndOfLineColumn",value:function(e,t){for(var n=0,r=t;r>0&&"\n"!=e[r-1];r--)n+=this._getCharacterLength(e[r-1]);for(var o=t;o<e.length&&"\n"!=e[o];o++)n+=this._getCharacterLength(e[o]);return n}},{key:"getEndOfLinePosition",value:function(e,t){for(;t<e.length&&"\n"!=e[t];)t++;return t}},{key:"_clipPosition",value:function(e,t){return Math.max(0,Math.min(t.length,e))}},{key:"_clipCoordinates",value:function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){r(e,t,n[t])})}return e}({},e,{line:this._clipLine(e.line,t)})}},{key:"_clipLine",value:function(e,t){var n=this.countLines(t);return Math.max(0,Math.min(n-1,e))}},{key:"_reduceCoordinates",value:function(e,t){switch(t){case"\n":return{column:0,line:e.line+1};default:return{column:e.column+this._getCharacterLength(t),line:e.line}}}},{key:"_getCharacterLength",value:function(e){switch(e){case"\t":return 4;default:return 1}}}])&&o(t.prototype,n),i&&o(t,i),e}();function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){u(e,t,n[t])})}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.textNavigationService=new i}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){var n=this,r=e.text;return a({},e,{carets:e.carets.map(function(e){return n._reduceCaret(r,e,t)})})}},{key:"_reduceCaret",value:function(e,t,n){return t.owner!==n.author?t:this._reduceOwnedCaret(e,t,n)}},{key:"_reduceOwnedCaret",value:function(e,t,n){var r=this.textNavigationService.getCaretCoordinates(e,t.beginPosition),o=this._reduceCaretCoordinatesBy(t,r,n.offset),i=this.textNavigationService.getCaretPosition(e,o);return a({},t,{beginPosition:i,endPosition:i,lastOperation:"navigation vertical",verticalNavigationColumn:o.column})}},{key:"_reduceCaretCoordinatesBy",value:function(e,t,n){return{column:"navigation vertical"!==e.lastOperation?t.column:e.verticalNavigationColumn,line:t.line+n}}}])&&c(t.prototype,n),r&&c(t,r),e}();function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){f(e,t,n[t])})}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var b=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){var n=this;return s({},e,{carets:e.carets.map(function(r){return n._reduceCaret(e,t,r)})})}},{key:"_reduceCaret",value:function(e,t,n){if(n.owner!==t.author)return n;var r=this._clipPosition(e,n.beginPosition+t.offset);return s({},n,{beginPosition:r,endPosition:r,lastOperation:"navigation horizontal"})}},{key:"_clipPosition",value:function(e,t){return Math.max(0,Math.min(e.text.length,t))}}])&&v(t.prototype,n),r&&v(t,r),e}();function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.verticalNavigationEventReducer=new l,this.horizontalNavigationEventReducer=new b}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){return this._getReducer(t).reduce(e,t)}},{key:"_getReducer",value:function(e){switch(e.mode){case"move-horizontally":return this.horizontalNavigationEventReducer;case"move-vertically":return this.verticalNavigationEventReducer}}}])&&y(t.prototype,n),r&&y(t,r),e}();function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){var n=e.text.substring(0,t.beginPosition),r=e.text.substring(t.endPosition);return"".concat(n).concat(t.text).concat(r)}}])&&p(t.prototype,n),r&&p(t,r),e}();function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){var n=this;return e.carets.map(function(e){return n._reduceCaret(e,t)})}},{key:"_reduceCaret",value:function(e,t){return e.endPosition<t.beginPosition?e:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){d(e,t,n[t])})}return e}({},e,{beginPosition:this._reducePosition(e.beginPosition,t),endPosition:this._reducePosition(e.endPosition,t),lastOperation:"insertion"})}},{key:"_reducePosition",value:function(e,t){return e<t.beginPosition?e:e<=t.endPosition?t.beginPosition+t.text.length:e-(t.endPosition-t.beginPosition)+t.text.length}}])&&m(t.prototype,n),r&&m(t,r),e}();function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var O=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"getIndentAtPosition",value:function(e,t){for(var n=0,r=t-1;r>=0&&"\n"!==e[r];r--)n=this._reduceIndent(n,e[r]);return n}},{key:"_reduceIndent",value:function(e,t){return"\t"===t?e+1:0}}])&&P(t.prototype,n),r&&P(t,r),e}();function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var j=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._textFormattingService=new O}var t,n,r;return t=e,(n=[{key:"prepareEvent",value:function(e,t,n){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){_(e,t,n[t])})}return e}({},t,{text:this._prepareEventText(e,t,n),beginPosition:n.beginPosition,endPosition:n.endPosition})}},{key:"_prepareEventText",value:function(e,t,n){if("\n"!==t.text)return t.text;var r=this._textFormattingService.getIndentAtPosition(e.text,n.beginPosition);return"\n".concat("\t".repeat(r))}}])&&k(t.prototype,n),r&&k(t,r),e}();function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._eventPreProcessor=new j,this._textReducer=new g,this._caretReducer=new w}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){for(var n in e.carets)e=this._reduceUsingCaret(e,t,e.carets[n]);return e}},{key:"_reduceUsingCaret",value:function(e,t,n){return t.author!==n.owner?e:(t=this._eventPreProcessor.prepareEvent(e,t,n),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){C(e,t,n[t])})}return e}({},e,{text:this._textReducer.reduce(e,t),carets:this._caretReducer.reduce(e,t)}))}}])&&E(t.prototype,n),r&&E(t,r),e}();function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var R=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){var n=e.text.substring(0,t.beginPosition),r=e.text.substring(t.endPosition);return"".concat(n).concat(r)}}])&&x(t.prototype,n),r&&x(t,r),e}();function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var M=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){var n=this;return e.carets.map(function(e){return n._reduceCaret(e,t)})}},{key:"_reduceCaret",value:function(e,t){return e.endPosition<=t.beginPosition?e:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){T(e,t,n[t])})}return e}({},e,{beginPosition:this._reducePosition(e.beginPosition,t),endPosition:this._reducePosition(e.endPosition,t),lastOperation:"deletion"})}},{key:"_reducePosition",value:function(e,t){return e<=t.beginPosition?e:e<=t.endPosition?t.beginPosition:e-(t.endPosition-t.beginPosition)}}])&&D(t.prototype,n),r&&D(t,r),e}();function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var N=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"prepareEvent",value:function(e,t,n){var r=this._prepareRange(t,n);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){I(e,t,n[t])})}return e}({},t,{beginPosition:this._clipPosition(e,r.beginPosition),endPosition:this._clipPosition(e,r.endPosition),caret:n})}},{key:"_prepareRange",value:function(e,t){return t.beginPosition!=t.endPosition?{beginPosition:t.beginPosition,endPosition:t.endPosition}:"backward"==e.mode?{beginPosition:t.beginPosition-1,endPosition:t.beginPosition}:"forward"==e.mode?{beginPosition:t.beginPosition,endPosition:t.beginPosition+1}:void 0}},{key:"_clipPosition",value:function(e,t){return Math.max(0,Math.min(e.text.length,t))}}])&&A(t.prototype,n),r&&A(t,r),e}();function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var z=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._eventPreProcessor=new N,this._textReducer=new R,this._caretReducer=new M}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){for(var n in e.carets)e=this._reduceUsingCaret(e,t,e.carets[n]);return e}},{key:"_reduceUsingCaret",value:function(e,t,n){return t.author!==n.owner?e:(t=this._eventPreProcessor.prepareEvent(e,t,n),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){L(e,t,n[t])})}return e}({},e,{text:this._textReducer.reduce(e,t),carets:this._caretReducer.reduce(e,t)}))}}])&&q(t.prototype,n),r&&q(t,r),e}();function H(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var U=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._textNavigationService=new i}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){B(e,t,n[t])})}return e}({},e,{carets:this._reduceCarets(e,t)})}},{key:"_reduceCarets",value:function(e,t){var n=this._textNavigationService.getCaretPosition(e.text,t.coordinates);return H(e.carets).concat([{owner:t.author,beginPosition:n,endPosition:n,lastOperation:"creation"}])}}])&&F(t.prototype,n),r&&F(t,r),e}();function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var J=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){W(e,t,n[t])})}return e}({},e,{carets:this._reduceCarets(e.carets,t)})}},{key:"_reduceCarets",value:function(e,t){return e.filter(function(e){return e.owner!=t.author})}}])&&G(t.prototype,n),r&&G(t,r),e}();function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Q(e,t,n[t])})}return e}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var X=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._textNavigationService=new i}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){var n=this;return K({},e,{carets:e.carets.map(function(r){return n._reduceCaret(e,t,r)})})}},{key:"_reduceCaret",value:function(e,t,n){if(n.owner!=t.author)return n;var r=n.beginPosition,o=this._textNavigationService.getCaretPosition(e.text,t.coordinates);if(o<r){var i=r;r=o,o=i}return K({},n,{beginPosition:r,endPosition:o,lastOperation:"selection"})}}])&&V(t.prototype,n),r&&V(t,r),e}();function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Z=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.caretCreationEventReducer=new U,this.caretRemovalEventReducer=new J,this.selectionEventReducer=new X}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){return this._getReducer(t).reduce(e,t)}},{key:"_getReducer",value:function(e){switch(e.operation){case"add-caret":return this.caretCreationEventReducer;case"remove-carets":return this.caretRemovalEventReducer;case"select":return this.selectionEventReducer}}}])&&Y(t.prototype,n),r&&Y(t,r),e}();function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ee=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.insertionEventReducer=new S,this.deletionEventReducer=new z,this.navigationEventReducer=new h,this.caretManagementEventReducer=new Z}var t,n,r;return t=e,(n=[{key:"_getReducer",value:function(e){switch(e.type){case"insert":return this.insertionEventReducer;case"delete":return this.deletionEventReducer;case"navigate":return this.navigationEventReducer;case"manage-carets":return this.caretManagementEventReducer;default:throw new Error("Event not recognized")}}},{key:"reduce",value:function(e,t){return this._getReducer(t).reduce(e,t)}}])&&$(t.prototype,n),r&&$(t,r),e}();function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ne=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"_getTimestamp",value:function(e,t){return e[t].event.timestamp}},{key:"_inRange",value:function(e,t){return t>=0&&t<e.length}},{key:"_cleanState",value:function(e,t){e[t].state=null}},{key:"_isTooFarAhead",value:function(e,t){return!!this._inRange(e,t+1)&&this._getTimestamp(e,t)<this._getTimestamp(e,t+1)}},{key:"_moveBackward",value:function(e,t){var n=e[t+1];e[t+1]=e[t],e[t]=n,this._cleanState(e,t),this._cleanState(e,t+1)}},{key:"fix",value:function(e){for(var t=0;this._isTooFarAhead(e,t);)this._moveBackward(e,t++)}}])&&te(t.prototype,n),r&&te(t,r),e}();function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var oe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._eventReducer=new ee}var t,n,r;return t=e,(n=[{key:"_reduceHistoryOffset",value:function(e,t){return"undo"===t.type?e+1:(t.type,e-1)}},{key:"_isHistoryEvent",value:function(e){return"undo"==e.type||"redo"===e.type}},{key:"_getPreviousStateIndex",value:function(e,t){if(!this._isHistoryEvent(e[t].event))return t+1;var n=0;do{n=this._reduceHistoryOffset(n,e[t].event),t++}while(n>0||this._isHistoryEvent(e[t].event));if(0!==n)throw new Error;return t}},{key:"_reduceState",value:function(e,t){return this._isHistoryEvent(t)?e:this._eventReducer.reduce(e,t)}},{key:"_getState",value:function(e,t){if(e[t].state)return e[t].state;var n=this._getPreviousStateIndex(e,t),r=this._getState(e,n);return this._reduceState(r,e[t].event)}},{key:"updateCurrentState",value:function(e){e[0].state=this._getState(e,0)}}])&&re(t.prototype,n),r&&re(t,r),e}();function ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ae=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"_cleanupStates",value:function(e){for(var t=this._closestIndexWithState(e,Math.min(12,e.length-1)),n=1;n<t;n++)e[n].state=null}},{key:"_closestIndexWithState",value:function(e,t){for(;!e[t].state;)t--;return t}},{key:"_cleanupLength",value:function(e){e.length<300||e.splice(this._closestIndexWithState(e,250)+1)}},{key:"cleanup",value:function(e){this._cleanupLength(e),this._cleanupStates(e)}}])&&ie(t.prototype,n),r&&ie(t,r),e}();function ue(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var le=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._chain=t,this._eventReducer=new ee,this._eventStoreRepair=new ne,this._eventStoreState=new oe,this._eventStoreCleanup=new ae}var t,n,r;return t=e,(n=[{key:"_reduceChain",value:function(e){return[{event:e,state:null}].concat(ue(this._chain))}},{key:"add",value:function(e){var t=this._reduceChain(e);try{this._eventStoreRepair.fix(t),this._eventStoreState.updateCurrentState(t),this._eventStoreCleanup.cleanup(t)}catch(e){return console.dir(e),!1}return this._chain=t,!0}},{key:"history",get:function(){return this._chain}},{key:"state",get:function(){return this._chain[0].state}}])&&ce(t.prototype,n),r&&ce(t,r),e}();function se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var fe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t||(t=[{event:{timestamp:Date.now()},state:{carets:[],text:""}}]),this._eventStore=new le(t)}var t,n,r;return t=e,(n=[{key:"addEvent",value:function(e){this._eventStore.add(e),console.dir(this.history)}},{key:"history",get:function(){return this._eventStore.history}},{key:"state",get:function(){return this._eventStore.state}}])&&se(t.prototype,n),r&&se(t,r),e}();function ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var be=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._documents=new Map}var t,n,r;return t=e,(n=[{key:"getDocument",value:function(e){return this._createIfDoesntExist(e),this._documents.get(e)}},{key:"_createIfDoesntExist",value:function(e){this._documents.has(e)||this._documents.set(e,new fe)}}])&&ve(t.prototype,n),r&&ve(t,r),e}());t.a=be},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("cors")},function(e,t,n){n(7),e.exports=n(8)},function(e,t){e.exports=require("@babel/polyfill")},function(e,t,n){"use strict";n.r(t),function(e){var t=n(2),r=n.n(t),o=n(0),i=n.n(o),a=n(3),u=n.n(a),c=n(4),l=n.n(c),s=n(5),f=n.n(s),v=n(1);function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=process.env.PORT||1337,h=i()();h.use(i.a.static(l.a.join(e,"public"))),h.use(f()({origin:["http://localhost:8080","http://text-sourcing.tomasz-rewak.com"]})),h.get(["/document/:documentId"],function(e,t){var n=v.a.getDocument(e.params.documentId).history;console.dir(n),t.json(n)});var p=r.a.Server(h),g=new u.a(p);g.origins(["http://localhost:8080","http://text-sourcing.tomasz-rewak.com:80"]),g.on("connection",function(e){console.log("Got connected!");var t=e.handshake.query.document;e.join(t);var n=v.a.getDocument(t),r=function(r){var o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){b(e,t,n[t])})}return e}({},r,{author:e.id});n.addEvent(o),e.broadcast.to(t).emit("document change",o)};e.on("document change",function(e,t){try{r(e),t(!0)}catch(e){t(!1)}}),e.on("disconnect",function(){console.log("Got disconnected!"),r({type:"manage-carets",operation:"remove-carets",timestamp:Date.now()})})}),p.listen(y,function(){return console.log("Example app listening on port ".concat(y,"!"))})}.call(this,"/")}]);